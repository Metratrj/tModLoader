<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tModLoader: Dedicated Server Utils</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="tModLoaderIcon-Small.png"/></td>
  <td id="projectalign">
   <div id="projectname">tModLoader<span id="projectnumber">&#160;v2024.02</span>
   </div>
   <div id="projectbrief">A mod to make and play Terraria mods</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__github_workspace_src_t_mod_loader__terraria_release_extras__dedicated_server_utils__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Dedicated Server <a class="el" href="class_utils.html">Utils</a> </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This directory contains utilities for a dedicated server on Linux or Docker</p>
<h2>Installation Options</h2>
<p ><b>Currently ARM support does not exist for TML</b>. While both the Docker container and the management script can install and update tModLoader and any mods, there are a few key differences. Docker isolates tModLoader from your host system, allowing for less manual management and increased security. The management script allows for direct access to your server and increased control as a result</p>
<h1>Quick Links</h1>
<p >Docker Installation (recommended)</p>
<p >Management Script Installation</p>
<p >Installing Mods</p>
<p >Example Folder Structure</p>
<p >Server Configuration</p>
<p >Updating the Management Script</p>
<h1>1.4.4 Migration</h1>
<p >The 1.4.4 script is a <b>backwards-incompatible update</b> that introduces a new folder structure that both the management script and the Docker container need to conform to. Additionally, the management script has moved from flags to commands for installing, updating and starting the server. Run <code>./manage-tModLoaderServer.sh -h</code> to see a list of available commands and flags</p>
<hr  />
<h1>Using The Docker Container</h1>
<p >To install and run the container:</p><ol type="1">
<li>Install <code>docker</code> from your package manager or <a href="https://docs.docker.com/engine/install/">Docker's Official Page</a><ul>
<li><b>To check if Compose V2 is installed in this package</b>, run <code>docker compose version</code>. If the command errors, your manager still uses V1 and will need to additionally install the <code>docker-compose</code> package. All commands below assume Compose V2 is installed, so if you have V1 replace any <code>docker compose</code> commands with <code>docker-compose</code></li>
</ul>
</li>
<li>Download <a href="https://github.com/tModLoader/tModLoader/tree/1.4.4/patches/tModLoader/Terraria/release_extras/DedicatedServerUtils/docker-compose.yml">docker-compose.yml</a> and the <a href="https://github.com/tModLoader/tModLoader/tree/1.4.4/patches/tModLoader/Terraria/release_extras/DedicatedServerUtils/Dockerfile">Dockerfile</a></li>
<li>Create an empty folder named <code>tModLoader</code>. This is <b>required</b>. If you would like to install mods or use existing worlds then setup a proper folder structure in that directory</li>
<li>Edit <code>docker-compose.yml</code> with your GID and UID. These can be found by running <code>id</code>, and generally default to 1000<ul>
<li>You can also add the <code>TML_VERSION</code> arg to your compose file to set a specific tModLoader version. Read about how to set build arguments <a href="https://docs.docker.com/compose/compose-file/build/#args">here</a></li>
<li>Uncomment the <code>restart</code> line to have the server automatically restart if it crashes</li>
</ul>
</li>
<li>Run <code>docker compose up</code><ul>
<li>If serverconfig.txt exists in the <code>tModLoader</code> directory add <code>-d</code> to the end to run without interactivity. To attach to the server console run <code>docker attach tml</code>. To detach from the console press <code>Ctrl-P Ctrl-Q</code> to avoid shutting down or <code>Ctrl-C</code> to detach and shutdown the server</li>
<li>This will create the <code>Mods</code> and <code>Worlds</code> directories if they don't already exist</li>
</ul>
</li>
</ol>
<h2>Updating</h2>
<p >To update, download the newest container and rebuild it using <code>docker compose build</code> to update tModLoader. Mods will be updated as well. If the container doesn't rebuild you can force rebuilding by running <code>docker compose build --no-cache</code></p>
<hr  />
<h1>Using The Management Script</h1>
<p >The <code>manage-tModLoaderServer.sh</code> script can be used to install tModLoader either directly from the GitHub release or from SteamCMD. The script is made to run fully standalone, so just download it to your server and run it. No other files from the repo are needed</p>
<h2>Installing tModLoader</h2>
<h3>SteamCMD (recommended)</h3>
<ol type="1">
<li>Ensure SteamCMD is installed and on your PATH. You can install SteamCMD from your package manager or <a href="https://developer.valvesoftware.com/wiki/SteamCMD">Valve's Wiki</a>. If your distribution cannot install SteamCMD the standard way, download it manually and pass in <code>steamcmdpath</code> to the management script</li>
<li>Run <code>./manage-tModLoaderServer.sh install-tml --username your_steam_username</code> and enter any password/2fa if necessary. tModLoader will install to the <code>server</code> directory in your installation folder</li>
</ol>
<h3>GitHub</h3>
<ol type="1">
<li>Run <code>./manage-tModLoaderServer.sh install-tml --github</code>. This will install the latest GitHub release, which is the same version as released on Steam.<ul>
<li>If you wish to use a specific/legacy tModLoader version from Github, provide either a <code>tmlversion.txt</code> file from a modpack or pass the <code>--tml-version</code> flag with a specified version, ex. <code>v2022.06.96.4</code></li>
</ul>
</li>
</ol>
<h2>Installing Mods</h2>
<p >Mods will be automatically installed during the tModLoader installation step, but can also be installed separately by running <code>./manage-tModLoaderServer.sh install-mods</code>. No mods will be installed if <code>install.txt</code> is missing, and no mods will be enabled if <code>enabled.json</code> is missing. <b>You will need a <code>Mods/enabled.json</code> to contain all Mods that you want enabled</b>.</p>
<h2>Launching</h2>
<p >To start a server, run <code>./manage-tModLoaderServer.sh start</code>. Be sure to pass in <code>--folder</code> again if you used a custom location during installation</p>
<h2>Updating</h2>
<p ><code>./manage-tModLoaderServer.sh install</code> will update both TML and your mods. To update just mods, run the <code>install-mods</code> command. To only update TML, run the <code>install-tml</code> command</p>
<hr  />
<h1>Folder Structure</h1>
<p >Both the Docker and Management script use the same folder structure, so make sure it's setup properly before installing. Here is an example:</p>
<div class="fragment"><div class="line">├── Mods</div>
<div class="line">│   ├── localmod1.tmod</div>
<div class="line">│   ├── localmod2.tmod</div>
<div class="line">│   ├── enabled.json</div>
<div class="line">│   └── install.txt</div>
<div class="line">├── Worlds</div>
<div class="line">│   ├── world1.twld</div>
<div class="line">│   ├── world1.wld</div>
<div class="line">│   ├── world2.twld</div>
<div class="line">│   └── world2.wld</div>
<div class="line">├── server</div>
<div class="line">│   └── * contains tModLoader installation *</div>
<div class="line">├── steamapps</div>
<div class="line">│   └── * contains Steam workshop mods *</div>
<div class="line">├── logs</div>
<div class="line">│   └── * contains tModLoader logs *</div>
<div class="line">├── manage-tModLoaderServer.sh</div>
<div class="line">├── serverconfig.txt</div>
<div class="line">└── tmlversion.txt</div>
</div><!-- fragment --><p> The <code>server</code>, <code>steamapps</code> and <code>logs</code> folders are created by the management script and do not need to be edited unless you want to clear your installation. <code>manage-tModLoaderServer.sh</code> is not necessary in the Docker version</p>
<h2>Obtaining install.txt</h2>
<p >Because the steam workshop does not use mod names to identify mods, you must create a modpack to install mods from the workshop. To get an <code>install.txt</code> file and its accompanying <code>enabled.json</code></p><ol type="1">
<li>Go to Workshop</li>
<li>Go to <a class="el" href="class_mod.html" title="Mod is an abstract class that you will override. It serves as a central place from which the mod&#39;s co...">Mod</a> Packs</li>
<li>Click <code>Save Enabled as New <a class="el" href="class_mod.html" title="Mod is an abstract class that you will override. It serves as a central place from which the mod&#39;s co...">Mod</a> Pack</code></li>
<li>Click <code>Open <a class="el" href="class_mod.html" title="Mod is an abstract class that you will override. It serves as a central place from which the mod&#39;s co...">Mod</a> Pack Folder</code></li>
<li>Enter the folder with the name of your modpack</li>
<li>Make a <code>Mods</code> folder and copy <code>install.txt</code> and <code>enabled.json</code> file into it</li>
<li>Run <code>./manage-tModLoaderServer.sh install-mods</code> to install the mods on your server. <b>This is not necessary if you are using Docker, it will be done automatically</b></li>
</ol>
<h2>Server Configuration</h2>
<p >If you want to run tModLoader without needing any input on startup (such as from an init system), copy the example <a href="https://github.com/tModLoader/tModLoader/tree/1.4.4/patches/tModLoader/Terraria/release_extras/serverconfig.txt">serverconfig.txt</a> and change the settings how you like. Key options are defined below, and other options can be found <a href="https://terraria.wiki.gg/wiki/Server#Server_config_file">on the Terraria wiki</a></p><ul>
<li><code>worldname</code> changes the default world name when creating a new world using autocreate <b>You do not need to include .wld in your world name</b>. This setting <b>will not</b> work with an existing world, see the <code>world</code> option for an existing world</li>
<li><code>world</code> sets the exact path to an existing or new terraria world, ex. <code>worldpath/to/your/world.wld</code>. <b>For Docker installations</b>, the world path must follow <code>/home/tml/.local/share/Terraria/tModLoader/Worlds/your_world.wld</code></li>
<li><code>autocreate=1</code> will enable autocreating, which creates a new world at your provided location if one does not already exist</li>
</ul>
<hr  />
<h1>Updating the Management Script</h1>
<p >If an update for <code>manage-tModLoaderServer.sh</code> is available, a message will be printed letting you know one is available. It can be updated using <code>./manage-tModLoaderServer.sh update-script</code>. An outdated script may contain bugs or lack features, so it is usually a good idea to update </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
